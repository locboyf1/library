<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{content/layout}">
<head>
    <meta charset="UTF-8"/>
    <title>Thư viện trực tuyến</title>
    <style>
        .book_grid_wrapper{padding:32px 0;}
        .book_header_bar{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;}
        .book_count{font-weight:600;font-size:18px;color:#333;}
        .sort_form{display:flex;align-items:center;gap:8px;}
        .sort_form .form-select{min-width:200px;}
        .book_item{background:#fff;border-radius:8px;overflow:hidden;margin-bottom:28px;transition:.2s;border:1px solid #eaeaea;}
        .book_item:hover{box-shadow:0 8px 24px rgba(0,0,0,.08);transform:translateY(-2px);}
        .img_wrapper{position:relative;height:240px;padding:12px;background:#f7f7f7;display:flex;align-items:center;justify-content:center;}
        .img_wrapper img{max-height:100%;width:auto;object-fit:cover;border-radius:6px;}
        .badge_new{position:absolute;top:10px;left:10px;background:#28c76f;color:#fff;font-size:12px;padding:4px 8px;border-radius:4px;font-weight:700;}
        .book_body{padding:14px;}
        .book_title{font-size:16px;font-weight:700;color:#222;margin:0 0 6px;line-height:1.3;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;min-height:44px;}
        .book_meta{font-size:13px;color:#666;margin-bottom:8px;display:flex;gap:10px;flex-wrap:wrap;}
        .status_badge{display:inline-block;font-size:12px;padding:2px 8px;border-radius:16px;background:#eef6ff;color:#0b5ed7;}
        .book_desc{font-size:13px;color:#555;height:40px;overflow:hidden;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;margin-bottom:12px;}
        .book_actions .bj_theme_btn{width:100%;font-size:13px;padding:8px 12px;}
        @media (max-width:991px){.img_wrapper{height:210px;}}
        @media (max-width:575px){.img_wrapper{height:180px;}}
    </style>
</head>
<body>
<div layout:fragment="content">
    <section class="book_grid_wrapper" data-bg-color="#f5f5f5">
        <div class="container">
            <div class="book_header_bar">
                <div class="book_count" th:text="${totalBooks != null ? totalBooks + ' sách' : '0 sách'}">0 sách</div>
                <form class="sort_form" method="get" th:action="@{/}" id="sortForm">
                    <label for="sortSelect" class="me-1">Sắp xếp:</label>
                    <select id="sortSelect" name="sort" class="form-select" th:value="${sort}">
                        <option value="">Mặc định</option>
                        <option value="newest" th:selected="${sort}=='newest'">Mới nhập</option>
                        <option value="nameAsc" th:selected="${sort}=='nameAsc'">Tên A→Z</option>
                        <option value="nameDesc" th:selected="${sort}=='nameDesc'">Tên Z→A</option>
                        <option value="yearDesc" th:selected="${sort}=='yearDesc'">Năm xuất bản mới</option>
                    </select>
                </form>
            </div>

            <div class="row">
                <th:block th:each="b : ${books}">
                    <div class="col-lg-3 col-md-4 col-sm-6">
                        <div class="book_item">
                            <div class="img_wrapper">
                                <span class="badge_new" th:if="${b['new']}">Mới</span>
                                <a th:href="@{/book/{id}(id=${b.maSach})}">
                                    <img th:src="${b.anhBia}" th:alt="${b.tenSach}"/>
                                </a>
                            </div>
                            <div class="book_body">
                                <a th:href="@{/book/{id}(id=${b.maSach})}">
                                    <h5 class="book_title" th:text="${b.tenSach}">Tiêu đề sách</h5>
                                </a>

                                <div class="book_meta">
                                    <span th:text="${'Năm: ' + b.namXuatBan}">Năm: 2024</span>
                                    <span th:text="${'SL: ' + b.soLuong}">SL: 0</span>
                                    <span class="status_badge" th:text="${b.tinhTrangText}">Còn hàng</span>
                                </div>

                                <div class="book_desc" th:text="${b.moTa}">Mô tả ngắn của sách...</div>

                                <div class="book_actions">
                                    <button type="button"
                                            class="bj_theme_btn strock_btn add-to-cart-automated"
                                            th:attr="data-id=${b.maSach},data-name=${b.tenSach},data-img=${b.anhBia}">
                                        <i class="icon_cart_alt"></i> Thêm vào danh sách mượn
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </th:block>

                <div class="col-12 text-center" th:if="${#lists.isEmpty(books)}">
                    <p>Chưa có sách để hiển thị.</p>
                </div>
            </div>

            <div class="d-flex justify-content-center mt-3" th:if="${pageTotal > 1}">
                <nav>
                    <ul class="pagination">
                        <li class="page-item" th:classappend="${page == 0} ? 'disabled'">
                            <a class="page-link" th:href="@{/(page=${page - 1}, sort=${sort})}">«</a>
                        </li>
                        <li class="page-item" th:each="i : ${#numbers.sequence(0, pageTotal - 1)}"
                            th:classappend="${i == page} ? 'active'">
                            <a class="page-link" th:href="@{/(page=${i}, sort=${sort})}" th:text="${i+1}">1</a>
                        </li>
                        <li class="page-item" th:classappend="${page == pageTotal - 1} ? 'disabled'">
                            <a class="page-link" th:href="@{/(page=${page + 1}, sort=${sort})}">»</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </section>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const sortSelect = document.getElementById('sortSelect');
        if (sortSelect) sortSelect.addEventListener('change', () => document.getElementById('sortForm').submit());
        document.querySelectorAll('.add-to-cart-automated').forEach(btn => {
            btn.addEventListener('click', () => {
                const name = btn.getAttribute('data-name');
                alert('Đã thêm: ' + name + ' vào danh sách mượn (mô phỏng).');
            });
        });
    });
</script>
</body>
</html>
